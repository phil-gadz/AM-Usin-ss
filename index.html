<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport"/>
<title>AM Usin'ss</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
<link href="/manifest.json" rel="manifest"/>
<meta content="#121212" name="theme-color"/>
<meta content="yes" name="mobile-web-app-capable"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<link href="/icon-192.jpg" rel="icon" sizes="192x192" type="image/jpeg"/>
<link href="/icon-512.jpg" rel="icon" sizes="512x512" type="image/jpeg"/>
<link href="/apple-touch-icon-180.jpg" rel="apple-touch-icon"/>
<style>
    /* ================= BASE ================= */
    * { box-sizing: border-box; --day-padding: 6px; }
    html { box-sizing: border-box; }
    body{
      margin:0;
      padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0;
      font-family:'Poppins',sans-serif;
      background:#121212;
      color:#eee;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-x:hidden;
      overflow-y:auto;
      -webkit-overflow-scrolling:touch;
    }

    canvas#particles{ position:fixed; inset:0; width:100%; height:100%; pointer-events:none; z-index:0; display:block; }

    .logo-container{ display:flex; justify-content:center; align-items:center; padding:28px 12px 20px; z-index:1; gap:12px; }
    .logo{ width:200px; max-width:70vw; height:auto; filter:brightness(0) invert(1); display:block; }

    /* ========== BOUTON CAF (général) ========== */
    .caf-button{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:12px;
      background: linear-gradient(180deg, #141416 0%, #1c1c20 100%);
      color:#fff;
      font-weight:800;
      letter-spacing:0.6px;
      text-decoration:none;
      border:1px solid rgba(255,255,255,0.04);
      box-shadow: 0 8px 26px rgba(200,90,240,0.08), 0 0 12px rgba(140,60,220,0.04);
      cursor:pointer;
      transition: transform .16s ease, box-shadow .18s ease, filter .18s ease;
      position:relative;
      z-index:3;
      backdrop-filter: blur(2px);
      -webkit-tap-highlight-color: transparent;
    }
    .caf-button:hover{ transform: translateY(-3px) scale(1.02); box-shadow: 0 18px 46px rgba(200,90,240,0.16), 0 0 28px rgba(200,90,240,0.08); }
    .caf-button:active{ transform: translateY(0) scale(.99); }
    .caf-button:focus{ outline: none; box-shadow: 0 18px 46px rgba(200,90,240,0.2), 0 0 40px rgba(200,90,240,0.12); border-color: rgba(200,90,240,0.5); }

    /* subtle neon edge */
    .caf-button::before{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius:14px;
      background:linear-gradient(90deg, rgba(200,90,240,0.06), rgba(120,90,255,0.04));
      pointer-events:none;
      z-index:-1;
    }

    @keyframes caf-glow-breathe {
      0%{ box-shadow: 0 6px 20px rgba(200,90,240,0.06), 0 0 8px rgba(200,90,240,0.02); transform: translateY(0); }
      50%{ box-shadow: 0 14px 40px rgba(200,90,240,0.12), 0 0 18px rgba(200,90,240,0.06); transform: translateY(-2px); }
      100%{ box-shadow: 0 6px 20px rgba(200,90,240,0.06), 0 0 8px rgba(200,90,240,0.02); transform: translateY(0); }
    }
    .caf-button.glow { animation: caf-glow-breathe 3.2s ease-in-out infinite; }

    .caf-button .label { display:inline-block; transform: translateY(-1px); }

    /* variante pour la KRA header : moins haut, plus large (horizontal) */
    

    /* pager boutons spécifiques (bottom paging) */
    .pager {
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:16px;
      z-index:3300;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      pointer-events:auto;
      transition: opacity .28s ease, transform .28s ease;
      padding:6px;
    }
    .pager.visible { opacity:1; transform:translateX(-50%) translateY(0); pointer-events:auto; }
    .pager.hidden  { opacity:0; transform:translateX(-50%) translateY(8px); pointer-events:none; }

    .pager .pager-btn{ min-width:64px; padding:8px 12px; font-size:0.95rem; border-radius:10px; }

    /* === PLACEMENT : bouton AU-DESSUS du titre, centré, espacement soigné === */
    .kra-header{
      position:relative;
      width:100%;
      padding:12px 12px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:8px; /* espace vertical entre bouton et titre */
    }

    /* Buttons layout: grid for wide screens (4 equal columns), fallback to flex for narrow screens */
    
.kra-buttons{
      width:100%;
      max-width:760px;
      margin:0 auto;
      display:grid;
      /* 5 equal columns on desktop to ensure perfect symmetry around the center */
      grid-template-columns: repeat(5, minmax(120px, 1fr));
      gap:12px;
      align-items:center;
      justify-items:stretch; /* buttons stretch to fill each column equally */
      justify-content:center;
    }

/* Ensure each kra button stretches to fill its grid cell so widths are identical.
   Limit max-width to avoid overly wide buttons on very large screens. */
.kra-buttons 

/* Responsive: 3 columns on medium screens (tablet), 2 columns on small screens (mobile),
   and 1 column on very small screens to keep the block visually centered and balanced. */
@media (max-width:920px){
  .kra-buttons{
    grid-template-columns: repeat(3, minmax(100px, 1fr));
  }
  .kra-buttons 
}

@media (max-width:620px){
  .kra-buttons{
    grid-template-columns: repeat(2, minmax(96px, 1fr));
    gap:10px;
  }
  .kra-buttons 
}

@media (max-width:420px){
  .kra-buttons{
    grid-template-columns: repeat(1, minmax(96px, 1fr));
    gap:8px;
  }
  .kra-buttons 
}


    /* On small screens fallback to wrapable flex for a nicer layout */
    @media (max-width:620px){
      .kra-buttons{
        display:flex;
        flex-wrap:wrap;
        justify-content:center;
        gap:10px;
      }
      
    }

    .kra-title{
      z-index:3;
      font-weight:900;
      font-size:1.25rem;
      color:#fff;
      text-transform:uppercase;
      letter-spacing:.8px;
      text-shadow:0 2px 6px rgba(255,255,255,.96), 0 0 18px rgba(255,255,255,.86);
      margin:0;
      padding:8px 18px;
      text-align:center;
    }

    /* responsive : réduire la largeur et la hauteur sur écrans moyens */
    @media (max-width:920px){
      
      .kra-header{ padding:10px 10px; gap:6px; }
    }

    @media (max-width:420px){
      .kra-buttons{ gap:8px; }
      
      .kra-header{ padding:8px 8px; gap:6px; }
    }

    @keyframes glitch-crt {
      0%{transform:translate(0,0)}25%{transform:translate(-2px,2px) skew(.5deg)}50%{transform:translate(2px,-2px) skew(-.5deg)}75%{transform:translate(-1px,-1px)}100%{transform:translate(0,0)}
    }
    .logo.glitch{ filter:brightness(0) invert(1) drop-shadow(-3px 0 magenta) drop-shadow(3px 0 cyan) contrast(2.2); animation:glitch-crt .15s steps(1) infinite; }

    /* ================= KRA CARD ================= */
    .kra-outer{ --outer-radius:12px; width:min(92%,900px); max-width:900px; margin:0 auto; position:relative; z-index:2; }
    .kra-container{
      --bg:#1b1b1f;
      border-radius:12px;
      padding:12px 16px;
      background-image:
        linear-gradient(var(--bg),var(--bg)),
        linear-gradient(90deg,var(--bg) 0%,var(--bg) 42%,#ff4aad 48%,#c86bff 50%,#8e2be2 52%,var(--bg) 58%,var(--bg) 100%);
      background-origin:padding-box,border-box;
      background-clip:padding-box,border-box;
      background-size:100% 100%,300% 100%;
      animation:kra-border-slide 6.8s linear infinite;
      border:2px solid transparent;
      display:flex;
      flex-direction:column;
      align-items:stretch;
      gap:8px;
      color:#eee;
      position:relative;
      overflow:visible;
      isolation:isolate;
    }
    .kra-container::before{
      content:"";
      position:absolute;
      inset:-22px;
      border-radius:calc(12px + 22px);
      background:radial-gradient(50% 60% at 50% 45%, rgba(200,90,240,0.46) 0%, rgba(200,90,240,0.30) 18%,rgba(200,90,240,0.14) 36%, rgba(140,60,220,0.06) 56%, transparent 78%);
      filter:blur(20px);
      z-index:0;
      pointer-events:none;
      transform-origin:center center;
      animation:kra-glow-breathe 3s cubic-bezier(.4,0,.2,1) infinite alternate;
      opacity:0.92;
      backface-visibility:hidden;
    }

    @keyframes kra-border-slide{ 0%{background-position:0% 50%,0% 50%}50%{background-position:0% 50%,100% 50%}100%{background-position:0% 50%,0% 50%} }
    @keyframes kra-glow-breathe{ from{transform:scale(1);filter:blur(16px);opacity:.75}60%{transform:scale(1.045);filter:blur(28px);opacity:.93}to{transform:scale(1.09);filter:blur(40px);opacity:1} }

    .kra-container > * { position:relative; z-index:3; }

    #kra-msg{ min-height:56px; padding:12px; border-radius:10px; background:rgba(0,0,0,0.28); color:#fff; font-size:1rem; line-height:1.35; text-align:center; }

    /* ================= PROCHAINE MANIP ================= */
    .next-manip{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 14px;
      border-radius:10px;
      background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015));
      border:1px solid rgba(255,255,255,0.04);
      color:#fff;
      min-height:56px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
    }
    .next-manip .left{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .next-manip .label{
      font-size:.78rem;
      color:rgba(255,255,255,0.6);
      text-transform:uppercase;
      letter-spacing:0.6px;
      font-weight:800;
    }
    .next-manip .title{
      font-weight:900;
      font-size:1.02rem;
      color:#fff;
    }
    .next-manip .when{
      font-size:.92rem;
      color:rgba(255,255,255,0.85);
    }
    .next-manip .cta{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 12px;
      border-radius:10px;
      background:linear-gradient(90deg,#ff4aad,#8e2be2);
      color:#fff;
      font-weight:800;
      cursor:pointer;
      border:none;
    }

    /* layout for countdown + cta on right column */
    .next-right {
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:8px;
    }
    #next-countdown { font-weight:700; font-size:.95rem; color:rgba(255,255,255,0.9); }

    /* ================= SEARCH ROW + SUGGESTIONS ================= */
    .search-wrap{ position:relative; width:100%; display:flex; justify-content:center; }
    .search-row{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      padding:10px 6px 0;
      z-index:3;
      width:100%;
      max-width:900px;
      box-sizing:border-box;
    }
    .search-input{
      min-width:220px;
      max-width:640px;
      width:60%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.06);
      background:rgba(0,0,0,0.35);
      color:#fff;
      font-size:1rem;
      outline:none;
      box-shadow: 0 6px 14px rgba(0,0,0,0.6) inset;
    }
    .search-input::placeholder{ color:rgba(255,255,255,0.42); font-weight:500; }
    .search-btn{
      padding:10px 14px;
      border-radius:10px;
      border:none;
      background:linear-gradient(180deg,#2b2b30,#161617);
      color:#fff;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 8px 20px rgba(90,90,120,0.08);
      align-self:center;
      margin-top:0;
    }

    .suggestions{
      position:absolute;
      top:100%;
      left:50%;
      transform:translateX(-50%);
      margin-top:10px;
      background:rgba(10,10,10,0.98);
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.06);
      min-width:240px;
      max-width:84%;
      width:calc(60% + 120px);
      z-index:40;
      box-shadow:0 12px 30px rgba(0,0,0,0.6);
      overflow:hidden;
      max-height:320px;
      overflow-y:auto;
      display:none;
    }
    .suggestions.visible{ display:block; }
    .suggestions .item{
      padding:10px 12px;
      font-weight:700;
      cursor:pointer;
      border-bottom:1px solid rgba(255,255,255,0.03);
    }
    .suggestions .item:last-child{ border-bottom:none; }
    .suggestions .item:hover{ background:rgba(255,255,255,0.03); }

    /* ================= CONTROLS + CALENDAR ================= */
    .controls{ width:100%; max-width:1400px; margin:12px auto 0; padding: 6px 12px 8px; box-sizing:border-box; display:flex; flex-direction:column; align-items:center; gap:12px; }

    .title-row h2{ margin:0; font-size:2rem; color:#fff; text-shadow:1px 1px 10px rgba(0,0,0,.7); text-align:center; }

    .calendar-controls{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
      width:100%;
      max-width:720px;
      margin-top:6px;
    }

    .calendar-controls .month-selector,
    .calendar-controls .days-selector{
      display:flex;
      align-items:center;
      gap:8px;
      background:transparent;
    }

    .select-wrap{ min-width:140px; }
    select, #month-select, #cols-select{ font-size:1em; padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.06); background-color:#000; color:#fff; -webkit-appearance:none; -moz-appearance:none; appearance:none; text-align:center; min-width:120px; }

    .calendar-wrap{ width:100%; max-width:1400px; padding:18px 12px 40px; box-sizing:border-box; margin:0 auto; }
    .calendar-container{ width:100%; display:block; }

    .week{ display:grid; --cols:3; grid-template-columns: repeat(var(--cols), minmax(0,1fr)); grid-template-rows:auto auto; gap:8px; margin-bottom:22px; align-items:start; width:100%; }
    .header{ background-color: rgba(31,31,31,0.30); color:#fff; font-weight:900; padding:10px 6px; font-size:1.02em; text-align:center; border-radius:10px; text-transform:uppercase; letter-spacing:.6px; min-height:44px; display:flex; align-items:center; justify-content:center; }
    .day{ background-color: rgba(44,44,44,0.18); min-height:110px; border-radius:15px; display:flex; flex-direction:column; justify-content:flex-start; align-items:flex-start; position:relative; cursor:pointer; padding:var(--day-padding); overflow:hidden; transition: transform .28s, box-shadow .28s; box-sizing:border-box; }
    .day:hover{ transform: translateY(-3px); box-shadow:0 14px 34px rgba(0,0,0,0.65); }

    .event{ position:relative; left:calc(var(--day-padding) * -1); width:calc(100% + (var(--day-padding) * 2)); border-radius:12px; color:#fff; font-weight:700; font-size:.95em; margin-bottom:8px; padding:10px 14px; display:flex; flex-direction:column; box-sizing:border-box; overflow-wrap:break-word; border:1px solid rgba(0,0,0,0.12); }
    .event .time{ font-size:.78em; color: rgba(255,255,255,0.98); margin-bottom:6px; font-weight:800; text-shadow: 0 1px 6px rgba(0,0,0,0.35); }
    .event .title{ font-weight:900; font-size:1.02em; }
    .event .description{ font-weight:400; font-size:.85em; color:#eee; margin-top:6px; }

    .event.blue{ background: linear-gradient(135deg,#00baff 0%,#0066ff 100%); box-shadow:0 8px 28px rgba(0,102,255,0.28); }
    .event.red{ background: linear-gradient(135deg,#ff3a7a 0%,#ff6a2a 100%); box-shadow:0 8px 28px rgba(255,60,120,0.26); }
    .event.pink{ background: linear-gradient(135deg,#ff7bdc 0%,#ff4aa8 100%); box-shadow:0 8px 28px rgba(255,80,160,0.24); }
    .event.yellow{ background: linear-gradient(135deg,#ffd400 0%,#ffb200 100%); color:#111; box-shadow:0 8px 28px rgba(255,180,40,0.20); }
    .event.grey{ background: linear-gradient(135deg,#9fa9b8 0%,#6e7076 100%); color:#111; box-shadow:0 8px 28px rgba(80,90,100,0.14); }
    .event.orange{ background: linear-gradient(135deg,#ff9944 0%,#ff7a00 100%); color:#111; box-shadow:0 8px 28px rgba(255,120,50,0.18); }
    .event.green{ background: linear-gradient(135deg,#2bd07b 0%,#0fa55d 100%); color:#05220e; box-shadow:0 8px 28px rgba(20,160,90,0.18); }
.event.purple{ background: linear-gradient(135deg,#8e2be2 0%,#6a0dad 100%); box-shadow:0 8px 28px rgba(142,43,226,0.28); }
    .event.text-black{ color:#000 !important; }

    /* ================= SEARCH-ANIMATE (single cycle, like kra) */
    .day.search-animate{
      position:relative;
      z-index:30;
      border-radius:15px;
      background-origin: padding-box, border-box;
      background-clip: padding-box, border-box;
      border:2px solid transparent;
      overflow:visible;
    }
    .day.search-animate::after{
      content:"";
      position:absolute;
      inset:-6px;
      border-radius:calc(15px + 6px);
      background: linear-gradient(90deg, var(--bg, #1b1b1f) 0%, var(--bg, #1b1b1f) 42%, #ff4aad 48%, #c86bff 50%, #8e2be2 52%, var(--bg, #1b1b1f) 58%, var(--bg, #1b1b1f) 100%);
      background-size: 300% 100%;
      z-index:-2;
      pointer-events:none;
      animation: search-border-slide 1600ms linear 0s 1 forwards;
    }
    .day.search-animate::before{
      content:"";
      position:absolute;
      inset:-18px;
      border-radius:calc(15px + 18px);
      background: radial-gradient(50% 60% at 50% 45%, rgba(200,90,240,0.46) 0%, rgba(200,90,240,0.30) 18%, rgba(200,90,240,0.14) 36%, rgba(140,60,220,0.06) 56%, transparent 78%);
      filter:blur(14px);
      z-index:-3;
      pointer-events:none;
      transform-origin:center center;
      animation: search-glow-breathe 1600ms cubic-bezier(.4,0,.2,1) 0s 1 forwards;
      opacity:0.95;
    }

    @keyframes search-border-slide{
      0%{ background-position:0% 50%; transform:scale(1); }
      50%{ background-position:100% 50%; transform:scale(1.01); }
      100%{ background-position:0% 50%; transform:scale(1); }
    }
    @keyframes search-glow-breathe{
      0%{ transform:scale(1); filter:blur(8px); opacity:0.7; }
      60%{ transform:scale(1.035); filter:blur(20px); opacity:0.95; }
      100%{ transform:scale(1.05); filter:blur(26px); opacity:0.0; }
    }

    /* zoom modal */
    .zoom-outer{ position:fixed; z-index:3000; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:auto; }
    .zoom-inner{ position:absolute; transform-origin:center center; transition: transform 380ms cubic-bezier(.22,.9,.32,1), left .42s, top .42s, width .42s, height .42s; will-change:transform; border-radius:14px; overflow:hidden; background:transparent; box-shadow:0 30px 80px rgba(0,0,0,0.6); }
    .zoom-fixed-close{ position:fixed; top:14px; right:14px; z-index:3201; background:#ff004f; color:#fff; border:none; padding:10px 14px; border-radius:9px; cursor:pointer; font-weight:700; box-shadow:0 6px 22px rgba(0,0,0,.45); }

    .overlay{ position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:2999; display:none; }

    .footer{ margin: 18px 0 40px; color: rgba(255,255,255,0.12); font-size:.85rem; text-align:center; }

    /* ================= RESPONSIVE ADJUSTMENTS FOR MOBILE (countdown / Voir / Rechercher) ================= */
    @media (max-width:920px){
      .logo{ width:160px; }
      .title-row h2{ font-size:1.6rem; }
      .controls{ margin:10px auto 0; padding:6px 12px 8px; }
      .calendar-controls{ max-width:640px; gap:10px; }
      .select-wrap{ min-width:120px; }
      .week{ gap:10px; }
      .day{ min-height:120px; }
      .logo-container{ gap:8px; padding:22px 8px 16px; }
      .search-input{ width:65%; }
      .next-manip .title{ font-size:0.98rem; }
    }

    @media (max-width:600px){
      /* Stack the next-manip elements vertically, center countdown and button */
      .next-manip{
        flex-direction:column;
        align-items:center;
        text-align:center;
        gap:10px;
      }
      .next-manip .left{
        align-items:center;
      }
      .next-right{
        width:100%;
        display:flex;
        flex-direction:column;
        align-items:center;
      }
      .next-right .cta{
        width:100%;
        max-width:220px;
      }
      /* Make suggestions fit nicer */
      .suggestions{ width:92%; left:4%; transform:none; top:calc(100% + 6px); }

      /* Search row stacks, button centered with breathing room */
      .search-row{
        flex-direction:column;
        gap:8px;
        padding:8px 8px 0;
      }
      .search-input{ width:100%; max-width:680px; }
      .search-btn{
        width:160px;
        align-self:center;
        margin-top:6px;
      }
    }

    @media (max-width:420px){
      .week{ --cols:2; grid-template-columns: repeat(var(--cols), minmax(0,1fr)); }
      .logo{ max-width:60vw; }
      .select-wrap{ min-width:100px; }
      .search-input{ width:100%; min-width:0; }
      .search-row{ flex-direction:column; gap:8px; padding:8px 8px 0; }
      .suggestions{ width:94%; left:3%; transform:none; }
      .next-manip{ padding:12px; gap:10px; }
      .next-right .cta{ width:100%; max-width:260px; }
      .next-right { align-items:center; }
      .search-btn{ width:100%; max-width:360px; }
      .kra-buttons{ gap:8px; }
    }

    /* freeze page while modal open: handled via JS (we set top and add class) */
    .modal-open{ position:fixed; left:0; right:0; overflow:hidden; }
  

/* PAGER RESPONSIVE FIX (v2)
   - desktop: pager expands up to wide max (keeps centered)
   - medium: buttons show text
   - small: buttons collapse to arrows only, label stays centered
*/
.pager{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:16px;
  z-index:3300;
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:center;
  pointer-events:auto;
  padding:8px;
  width: min(100%, 1100px);
  max-width: calc(100% - 48px);
  box-sizing:border-box;
  white-space:nowrap;
  flex-wrap:nowrap;
}

/* buttons default: allow text (desktop / tablet) */
.pager .pager-btn{
  flex:0 0 auto;
  min-width:64px;
  padding:8px 12px;
  height:auto;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:10px;
  box-sizing:border-box;
  text-align:center;
}

/* arrow-only buttons (add .arrow class to keep them compact) */
.pager .pager-btn.arrow{
  min-width:44px;
  width:44px;
  height:44px;
  padding:0;
}

/* label centered and flexible so arrows never jump */
.pager #pager-label{
  flex:1 1 420px;
  min-width:160px;
  max-width:70%;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:8px 14px;
  border-radius:10px;
  box-sizing:border-box;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

/* small screens: collapse non-arrow text */
@media (max-width:420px){
  .pager{ gap:8px; padding:6px; bottom:12px; max-width: calc(100% - 24px); }
  .pager .pager-btn{ min-width:44px; padding:0 6px; }
  .pager .pager-btn:not(.arrow) .pager-btn-text{ display:none; } /* hide non-arrow text */
  .pager #pager-label{ min-width:90px; padding:6px 8px; font-size:0.95rem; }
}

/* medium / large screens: show button text and increase spacing */
@media (min-width:900px){
  .pager{ gap:14px; padding:10px; }
  .pager .pager-btn .pager-btn-text{ display:inline-block; }
  .pager .pager-btn{ min-width:90px; padding:10px 14px; }
  .pager .pager-btn.arrow{ min-width:48px; width:48px; height:48px; }
  .pager #pager-label{ flex:1 1 560px; min-width:220px; max-width:60%; }
}


/* ================= MOBILE: enlarge kra buttons for legibility ================= */
@media (max-width:920px){
  .kra-buttons .caf-button.kra{
    font-size:1.06rem !important;
    padding:10px 14px !important;
    height:48px !important;
    min-height:48px !important;
    line-height:1.1 !important;
  }
}

@media (max-width:620px){
  .kra-buttons .caf-button.kra{
    font-size:1.08rem !important;
    padding:12px 16px !important;
    height:52px !important;
    min-height:52px !important;
    line-height:1.12 !important;
  }
}

@media (max-width:420px){
  .kra-buttons{
    grid-template-columns: repeat(1, minmax(120px, 1fr)) !important;
    gap:10px;
  }
  .kra-buttons .caf-button.kra{
    font-size:1.05rem !important;
    padding:12px 18px !important;
    height:56px !important;
    min-height:56px !important;
    line-height:1.14 !important;
    border-radius:12px;
  }
  /* ensure the pager and other controls have comfortable tap targets */
  .pager .pager-btn{ min-width:56px; height:56px; padding:10px; }
  .search-btn, .next-manip .cta{ min-height:48px; padding:10px 14px; }
}

</style>
<!-- ================= AUTO-RELOAD (polling) =================
       IMPORTANT: this check uses a custom header 'x-skip-sw' to force the SW
       to perform a real network fetch (network-only). Without that the SW
       could respond from cache and hide new deploys.
  -->
<script>
    (function(){
      const CHECK_URL = '/index.html'; // on check l'index (plus fiable)
      const INTERVAL_MS = 1 * 1000;   // 1s comme demandé
      let knownTag = null;
      let knownLM = null;
      let knownHash = null;

      function simpleHash(s){
        let h = 2166136261 >>> 0;
        for(let i=0;i<s.length;i++){
          h ^= s.charCodeAt(i);
          h = Math.imul(h, 16777619) >>> 0;
        }
        return h.toString(36);
      }

      async function headOrGet(url){
        // Try HEAD first, then GET. Both include header to bypass SW cache.
        try {
          const head = await fetch(url, { method: 'HEAD', cache: 'no-store', headers: { 'x-skip-sw': '1' } });
          if (head && head.ok) return head;
        } catch(e){
          // ignore and fallback to GET
        }
        return await fetch(url, { method: 'GET', cache: 'no-store', headers: { 'x-skip-sw': '1' } });
      }

      async function checkOnce(){
        try{
          const res = await headOrGet(CHECK_URL);
          if(!res || !res.ok){
            // nothing to do if server errors
            return;
          }

          const etag = res.headers.get('etag');
          const lm = res.headers.get('last-modified');

          if(etag){
            if(knownTag && knownTag !== etag){
              console.log('Auto-reload: ETag changed', knownTag, '→', etag);
              return reloadSafe();
            }
            knownTag = knownTag || etag;
            return;
          }

          if(lm){
            if(knownLM && knownLM !== lm){
              console.log('Auto-reload: Last-Modified changed', knownLM, '→', lm);
              return reloadSafe();
            }
            knownLM = knownLM || lm;
            return;
          }

          // fallback: read body and compare hash
          // ensure we have the body (if initial HEAD returned earlier, we need a GET)
          let txt;
          try {
            txt = await res.text();
          } catch(e){
            // maybe HEAD returned earlier; force GET
            const getRes = await fetch(CHECK_URL + '?_fetch=1', { method: 'GET', cache: 'no-store', headers: { 'x-skip-sw': '1' } });
            if(!getRes || !getRes.ok) return;
            txt = await getRes.text();
          }
          const h = simpleHash(txt);
          if(knownHash && knownHash !== h){
            console.log('Auto-reload: body hash changed', knownHash, '→', h);
            return reloadSafe();
          }
          knownHash = knownHash || h;
        }catch(err){
          // silent fail
          // console.warn('checkOnce error', err);
        }
      }

      // reload sécurisé : bypass cache en ajoutant timestamp au href
      function reloadSafe(){
        const url = new URL(window.location.href);
        url.searchParams.set('_r', Date.now());
        window.location.replace(url.toString());
      }

      // expose reloadSafe so SW message handler can call it
      window.reloadSafe = reloadSafe;

      window.addEventListener('load', ()=>{
        checkOnce();
        setInterval(checkOnce, INTERVAL_MS);
      });
    })();
  </script>
</head>
<body>
<canvas id="particles"></canvas>
<div class="logo-container">
<img alt="Logo" class="logo glitch" src="data:image/png;base64,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"/>
</div>
<div class="kra-outer">
<div class="kra-container" id="kra-container">
<div class="kra-header">
<!-- four buttons: HYMNES - CAF - CHANTS - ZAP (symétriques, centrés) -->
<div aria-label="Liens rapides" class="kra-buttons" role="toolbar">
<a aria-label="Ouvrir le dossier HYMNES" class="caf-button glow kra" href="https://drive.google.com/drive/folders/1wqX_V6nXPmzf8B4sqDyX04H81YtQn5wn?usp=drive_link" id="hymnes-btn" rel="noopener noreferrer" target="_blank">
<span class="label">HYMNES</span>
</a>
<a aria-label="Ouvrir le dossier CAF sur Google Drive" class="caf-button glow kra" href="https://drive.google.com/drive/folders/10BKkNHleIhqUGhCABqkPIw9dKcZGQ9vv?usp=drive_link" id="caf-btn-kra" rel="noopener noreferrer" target="_blank">
<span class="label">CAF</span>
</a>
<!-- BOUTON FLYER (inséré automatiquement) -->
<a aria-label="Ouvrir le dossier Flyer sur Google Drive" class="caf-button glow kra" href="https://drive.google.com/drive/folders/1OpovOD8fAmvqhzU7dyu3TMP2UpFcN8Z-?usp=drive_link" id="flyer-btn" rel="noopener noreferrer" style="display:inline-flex;align-items:center;justify-content:center;text-align:center;" target="_blank">
<span class="label">LOÜPETTE USIN'SS</span>
</a>
<a aria-label="Ouvrir le dossier CHANTS" class="caf-button glow kra" href="https://drive.google.com/drive/folders/1MyyjtflzVBngREnS5WHq1667aiZbi0Av?usp=drive_link" id="chants-btn" rel="noopener noreferrer" target="_blank">
<span class="label">CHANTS</span>
</a>
<a aria-label="Ouvrir le dossier ZAP" class="caf-button glow kra" href="https://drive.google.com/drive/folders/1uK1CvLjW_IAXa4VJcDYjsvKAXSLeqanS?usp=drive_link" id="zap-btn" rel="noopener noreferrer" target="_blank">
<span class="label">ZAP</span>
</a>
</div>
<div class="kra-title">KRA IMPORT'SS</div>
</div>
<!-- PROCHAINE MANIP : placé entre le titre KRA et la zone éditable -->
<div aria-live="polite" class="next-manip" id="next-manip" role="region">
<div class="left">
<div class="label">Prochaine manip</div>
<div class="title" id="next-title">—</div>
<div class="when" id="next-when">—</div>
</div>
<div class="next-right">
<div id="next-countdown">—</div>
<button class="cta" id="next-cta" title="Voir la manipulation">Voir</button>
</div>
</div>
<div id="kra-msg">Bienvenue sur AM Usin'ss.<br/>Dans le bon la team ?</div>
</div>
<!-- SEARCH WRAP: juste en dessous de la case KRA IMPORT'SS -->
<div aria-label="Recherche des manipulations" class="search-wrap">
<form autocomplete="off" class="search-row" id="search-form" onsubmit="return false;" role="search">
<input aria-label="Rechercher une manipulation" autocomplete="off" class="search-input" enterkeyhint="search" id="search-input" inputmode="search" placeholder="Rechercher une manip" spellcheck="false" type="search"/>
<!-- glow permanent sur le bouton -->
<button class="search-btn caf-button glow" id="search-btn" style="padding:10px 12px; height:44px; border-radius:10px;" type="submit">Rechercher</button>
</form>
<div aria-label="Résultats de la recherche" class="suggestions" id="suggestions" role="listbox"></div>
</div>
</div>
<!-- CONTROLS : title + compact responsive controls -->
<div aria-label="Contrôles calendrier" class="controls" role="region">
<div class="title-row">
<h2 id="month-title">Septembre 2025</h2>
</div>
<div aria-hidden="false" class="calendar-controls">
<div class="month-selector">
<div class="select-wrap" style="margin:0;">
<select aria-label="Choisir le mois" id="month-select">
<option selected="" value="9">Septembre</option>
<option value="10">Octobre</option>
<option value="11">Novembre</option>
</select>
</div>
</div>
<div class="days-selector" style="align-items:center;">
<label for="cols-select" style="font-size:0.95rem; color:#ddd; margin-right:6px;">Jours/ligne</label>
<div class="select-wrap">
<select aria-label="Nombre de jours par ligne" id="cols-select">
<option selected="" value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
<option value="6">6</option>
<option value="7">7</option>
</select>
</div>
</div>
</div>
</div>
<div class="calendar-wrap">
<div class="calendar-container" id="calendar"></div>
</div>
<div class="overlay" id="overlay"></div>
<div class="footer">224 Corp.</div>
<!-- pager element (sera piloté par JS) -->
<div aria-hidden="true" aria-label="Navigation mois" class="pager hidden" id="month-pager" role="navigation">
<button aria-label="Mois précédent" class="caf-button kra glow pager-btn" id="pager-prev">◀</button>
<div id="pager-label" style="font-weight:800; padding:6px 10px; border-radius:10px; background:rgba(0,0,0,0.4); border:1px solid rgba(255,255,255,0.04);">—</div>
<button aria-label="Mois suivant" class="caf-button kra glow pager-btn" id="pager-next">▶</button>
</div>
<script>
    /* ---------- GLITCH ---------- */
    const logoEl = document.querySelector('.logo');
    function triggerGlitch(){
      if(!logoEl) return;
      logoEl.classList.add('glitch');
      setTimeout(()=>{ logoEl.classList.remove('glitch'); setTimeout(triggerGlitch, 200 + Math.random() * 1300); }, 120);
    }
    triggerGlitch();

    /* ---------- PARTICLES (DPR-aware) ---------- */
    const canvas = document.getElementById('particles');
    const ctx = canvas.getContext && canvas.getContext('2d');
    let particles = [];
    let mouseX = null, mouseY = null;
    function resizeCanvas(){
      if(!canvas || !ctx) return;
      const dpr = window.devicePixelRatio || 1;
      canvas.width = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    window.addEventListener('mousemove', e=>{ mouseX = e.clientX; mouseY = e.clientY; });

    function initParticles(){
      particles = [];
      // use the canvas's actual client size (CSS pixels) so particles span the full visible area
      const w = canvas.clientWidth || Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
      const h = canvas.clientHeight || Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
      for(let i=0;i<90;i++){
        particles.push({ x: Math.random()*w, y: Math.random()*h, size: Math.random()*1.8+0.6, speed: Math.random()*0.35+0.12, opacity: Math.random()*0.5+0.3 });
      }
    }
    function drawParticles(){
      if(!ctx) return;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      particles.forEach(p=>{
        ctx.beginPath();
        ctx.shadowBlur = 15; ctx.shadowColor = 'rgba(255,0,255,0.8)';
        ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
        ctx.fillStyle = `rgba(255, 100, 255, ${p.opacity})`;
        ctx.fill();
        p.y -= p.speed;
        if(mouseX !== null && mouseY !== null){
          let dx = mouseX - p.x, dy = mouseY - p.y;
          let dist = Math.sqrt(dx*dx + dy*dy);
          if(dist < 100){ p.x -= dx * 0.002; p.y -= dy * 0.002; }
        }
        if(p.y < -p.size){ p.y = (canvas.clientHeight || Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0)) + p.size; p.x = Math.random()*(canvas.clientWidth || Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)); }
      });
      requestAnimationFrame(drawParticles);
    }
    initParticles();
    drawParticles();

    /* ---------- CALENDAR & DATA ---------- */
    const days = ["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"];
    const monthSelect = document.getElementById('month-select');
    const colsSelect = document.getElementById('cols-select');
    const calendarContainer = document.getElementById('calendar');
    const monthTitle = document.getElementById('month-title');
    const currentYear = 2025;
    let daysPerRow = parseInt(colsSelect.value,10) || 3;

    const eventsData = {
      /* --- SEPTEMBRE --- */
      "2025-09-01":[{time:"18:45",title:"Remise des num'ss",color:"blue"},{time:"19:15",title:"Flam'ss",color:"blue"}],
      "2025-09-02":[{time:"12:40",title:"Remise des Zagrises",color:"blue"},{time:"20:00",title:"Prise en m'ss",color:"red"}],
      "2025-09-03":[{time:"20:00",title:"Bottage d'oc'ss",color:"blue"}],
      "2025-09-04":[{time:"20:00",title:"Nuit du Carn'ss",color:"blue"}],
      "2025-09-05":[{time:"20:00",title:"Fin'ss Archis",color:"blue"}],
      "2025-09-06":[{time:"",title:"Wix P3",color:"pink"}],
      "2025-09-07":[{time:"",title:"Wix P3",color:"pink"}],
      "2025-09-08":[{time:"20:00",title:"Nuit des Sacqués",color:"blue"}],
      "2025-09-09":[{time:"11:00",title:"Essayage Zag",color:"blue"},{time:"20:00",title:"Chalon'ss/Boquette",color:"blue"}],
      "2025-09-10":[{time:"20:00",title:"Mort des Trad'ss",color:"blue"}],
      "2025-09-11":[{time:"12:00",title:"Visiste Learning Center",color:"blue"},{time:"18:30",title:"Prez UAI",color:"blue"},{time:"20:00",title:"Pal'ss UAI",color:"blue"}],
      "2025-09-12":[{time:"20:00",title:"Manip Banquet",color:"blue"}],
      "2025-09-15":[{time:"20:00",title:"Prez Foy'ss",color:"blue"}],
      "2025-09-16":[{time:"",title:"UAI",color:"yellow",textBlack:true}],
      "2025-09-17":[{time:"Aprem",title:"Solidarité Béthune",color:"blue"},{time:"20:00",title:"Hypo-bucque",color:"blue"}],
      "2025-09-18":[{time:"20:00",title:"KIN/Clun'ss",color:"blue"}],
      "2025-09-19":[{time:"20:00",title:"Déreunssage/Perm'ss/Porte-perm'ss",color:"blue"}],
            "2025-09-20":[{time:"",title:"Secours populaire",color:"purple"}],
      "2025-09-22":[{time:"20:00",title:"Birse/P3",color:"blue"}],
      "2025-09-23":[{time:"",title:"UAI",color:"yellow",textBlack:true}],
      "2025-09-24":[{time:"20:00",title:"Thuyssage Chop'ss",color:"blue"}],
      "2025-09-25":[{time:"20:00",title:"Manip Gorg'ss",color:"blue"}],
      "2025-09-26":[{time:"20:00",title:"Lettre à soi-même",color:"blue"}],
      "2025-09-27":[{time:"Soir",title:"Fin'ss Archis Chop'ss",color:"blue"}],
      "2025-09-28":[{time:"13:40",title:"Chop'ss",color:"red"}],
      "2025-09-29":[{time:"20:00",title:"Manip AMJE",color:"blue"}],
      "2025-09-30":[{time:"",title:"UAI",color:"yellow",textBlack:true}],
      /* --- OCTOBRE / NOVEMBRE --- */
      "2025-10-01":[{time:"20:00",title:"Hypo-bucque 2",color:"blue"}],
      "2025-10-02":[{time:"06:00",title:"Hypo-moütardes",color:"blue"},{time:"20:00",title:"Bordel'ss/Siber'ss/Knack",color:"blue"}],
      "2025-10-03":[{time:"20:00",title:"Nuit des justiciers",color:"blue"}],
      "2025-10-06":[{time:"",title:"Mise HU",color:"red"}],
      "2025-10-09":[{time:"20:00",title:"Nuit de la glacière",color:"blue"}],
      "2025-10-13":[{time:"",title:"Remise en usin'ss",color:"red"}],
      "2025-10-14":[{time:"20:00",title:"14 oct./125 ans",color:"blue"}],
      "2025-10-15":[{time:"20:00",title:"Lettre aux Archis",color:"blue"}],
      "2025-10-16":[{time:"20:00",title:"Nuit des Atel'ss",color:"blue"}],
      "2025-10-17":[{time:"20:00",title:"Nuit de la Rez/CC Trad'ss",color:"blue"}],
      "2025-10-20":[{time:"20:00",title:"Monôme de Birse/Tap'ss Foy'ss",color:"blue"}],
      "2025-10-21":[{time:"",title:"UAI",color:"yellow",textBlack:true}],
      "2025-10-22":[{time:"20:00",title:"Nuit des justiciers 2",color:"blue"}],
      "2025-10-23":[{time:"20:00",title:"Manip Bonsergent",color:"blue"}],
      "2025-10-24":[{time:"20:00",title:"Nuit des Sout'ss",color:"red"}],
      "2025-10-25":[{time:"",title:"DKL",color:"grey"}],
      "2025-10-26":[{time:"",title:"DKL",color:"grey"}],
      "2025-10-27":[{time:"",title:"DKL",color:"grey"}],
      "2025-10-28":[{time:"",title:"DKL",color:"grey"}],
      "2025-10-29":[{time:"",title:"DKL",color:"grey"}],
      "2025-10-30":[{time:"",title:"DKL",color:"grey"}],
      "2025-10-31":[{time:"",title:"DKL",color:"grey"}],
      "2025-11-01":[{time:"",title:"DKL",color:"grey"}],
      "2025-11-02":[{time:"",title:"DKL",color:"grey"}],
      "2025-11-03":[{time:"20:00",title:"Prez Fignoss",color:"blue"}],
      "2025-11-04":[{time:"",title:"UAI",color:"yellow",textBlack:true}],
      "2025-11-05":[{time:"20:00",title:"Pal'ss SE/Prom'ss",color:"blue"}],
      "2025-11-06":[{time:"20:00",title:"Comit'ss Paillards",color:"blue"}],
      "2025-11-07":[{time:"20:00",title:"Pal'ss Micro-Par'ss",color:"blue"}],
      "2025-11-08":[{time:"",title:"Wix Micro-Par'ss",color:"pink"}],
      "2025-11-09":[{time:"",title:"Wix Micro-Par'ss",color:"pink"}],
      "2025-11-10":[{time:"20:00",title:"Double Pal'ss/Amphi Ayat'ss/Nuit de l'Ours",color:"blue"}],
      "2025-11-11":[{time:"06:00",title:"Pal'ss Taper la phase",color:"blue"},{time:"12:00",title:"Pal'ss",color:"blue"},{time:"14:00",title:"Cérémonie 11 Nov.",color:"blue"},{time:"20:00",title:"Pal'ss dans les Sout'ss/Brûlage de Carn'ss",color:"blue"}],
      "2025-11-12":[{time:"06:00",title:"Pal'ss rébellion des washs",color:"blue"},{time:"20:00",title:"St El'ss",color:"red"}],
      "2025-11-13":[{time:"Jusqu'au soir",title:"St El'ss",color:"red"},{time:"20:00",title:"Dernière chouille de prom'ss",color:"blue"}],
      "2025-11-14":[{time:"20:00",title:"Fin'ss de remise de fam'ss/Soirée de zocquage",color:"blue"}],
      "2025-11-15":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-16":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-17":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-18":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-19":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-20":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-21":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-22":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-23":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-24":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-25":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-26":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-27":[{time:"",title:"Gnasse Fignoss",color:"orange"}],
      "2025-11-28":[{time:"Jusqu'au soir",title:"Gnasse Fignoss",color:"orange"},{time:"20:00",title:"Bapt'ss",color:"red"}],
      "2025-11-29":[{time:"",title:"Bapt'ss V2/Fignoss",color:"green"}],
      "2025-11-30":[]
    };

    function pad(n){ return String(n).padStart(2,'0'); }

    function generateCalendar(month, cols){
      calendarContainer.innerHTML = '';
      monthTitle.textContent = `${monthSelect.options[monthSelect.selectedIndex].text} ${currentYear}`;
      const daysInMonth = new Date(currentYear, month, 0).getDate();
      let dayCounter = 1;
      while(dayCounter <= daysInMonth){
        const weekDiv = document.createElement('div'); weekDiv.className = 'week';
        weekDiv.style.setProperty('--cols', cols);
        const rowDayNumbers = [];
        for(let i=0;i<cols;i++){
          if(dayCounter <= daysInMonth){ rowDayNumbers.push(dayCounter); dayCounter++; } else { rowDayNumbers.push(null); }
        }
        // headers
        for(let i=0;i<cols;i++){
          const header = document.createElement('div'); header.className = 'header';
          const d = rowDayNumbers[i];
          if(d){
            const weekday = new Date(currentYear, month-1, d).getDay();
            const dayName = days[(weekday + 6) % 7];
            header.textContent = `${dayName} ${pad(d)}`;
          } else { header.textContent = ''; header.style.visibility = 'hidden'; }
          weekDiv.appendChild(header);
        }
        // days
        for(let i=0;i<cols;i++){
          const dayBox = document.createElement('div'); dayBox.className = 'day'; dayBox.setAttribute('onclick','zoom(this)');
          const d = rowDayNumbers[i];
          if(d && d>0){
            const dateKey = `${currentYear}-${pad(month)}-${pad(d)}`;
            dayBox.setAttribute('data-date', dateKey);
            const events = eventsData[dateKey];
            if(events && events.length){
              events.forEach(evData=>{
                if(!evData || !evData.title) return;
                const ev = document.createElement('div'); ev.className = 'event';
                const colorClass = evData.color ? evData.color : 'blue';
                ev.classList.add(colorClass);
                if(evData.textBlack) ev.classList.add('text-black');
                // store metadata for mapping
                ev.setAttribute('data-event-title', evData.title);
                ev.setAttribute('data-event-date', dateKey);
                ev.setAttribute('data-event-time', evData.time || '');
                const timeDiv = document.createElement('div'); timeDiv.className = 'time'; timeDiv.innerText = evData.time ? evData.time : '';
                const titleDiv = document.createElement('div'); titleDiv.className = 'title'; titleDiv.innerText = evData.title;
                ev.appendChild(timeDiv); ev.appendChild(titleDiv);
                if(evData.description){ const desc = document.createElement('div'); desc.className='description'; desc.innerText = evData.description; ev.appendChild(desc); }
                dayBox.appendChild(ev);
              });
            }
          }
          weekDiv.appendChild(dayBox);
        }
        calendarContainer.appendChild(weekDiv);
      }
    }

    // initial render
    generateCalendar(parseInt(monthSelect.value,10), daysPerRow);

    /* ---------- ZOOM modal (freeze page scroll while open) ---------- */
    const overlay = document.getElementById('overlay');
    let zoomState = { open:false, origEl:null, scrollY:0, outer:null, closeBtn:null };

    function zoom(el){
      if(zoomState.open) return;
      zoomState.open = true;
      zoomState.origEl = el;
      // save scroll pos & freeze body by fixing it
      zoomState.scrollY = window.scrollY || window.pageYOffset || 0;
      document.body.classList.add('modal-open');
      document.body.style.top = `-${zoomState.scrollY}px`;

      overlay.style.display = 'block';

      const rect = el.getBoundingClientRect();
      const outer = document.createElement('div'); outer.className = 'zoom-outer';
      const inner = document.createElement('div'); inner.className = 'zoom-inner';
      const clone = el.cloneNode(true);
      clone.style.pointerEvents = 'auto';
      clone.style.background = 'transparent';
      clone.style.width = rect.width + 'px';
      clone.style.boxSizing = 'border-box';
      inner.appendChild(clone);

      inner.style.left = rect.left + 'px';
      inner.style.top = rect.top + 'px';
      inner.style.width = rect.width + 'px';
      inner.style.height = rect.height + 'px';
      inner.style.transform = 'translate(0,0) scale(1)';
      inner.style.zIndex = 3100;
      inner.style.borderRadius = '14px';
      inner.style.overflow = 'hidden';

      const closeBtn = document.createElement('button');
      closeBtn.className = 'zoom-fixed-close';
      closeBtn.innerText = 'Fermer';
      closeBtn.onclick = ()=> closeZoom();

      outer.appendChild(inner);
      document.body.appendChild(outer);
      document.body.appendChild(closeBtn);

      // target zoom (slightly reduced)
      const viewportW = window.innerWidth;
      const viewportH = window.innerHeight;
      const targetMaxW = Math.min(viewportW * 0.86, 900);
      const targetMaxH = Math.min(viewportH * 0.86, viewportH - 80);
      const scaleX = targetMaxW / rect.width;
      const scaleY = targetMaxH / rect.height;
      const scale = Math.min(scaleX, scaleY);

      const rectCenterX = rect.left + rect.width / 2;
      const rectCenterY = rect.top + rect.height / 2;
      const viewportCenterX = viewportW / 2;
      const viewportCenterY = viewportH / 2;
      const translateX = viewportCenterX - rectCenterX;
      const translateY = viewportCenterY - rectCenterY;

      zoomState.outer = outer;
      zoomState.closeBtn = closeBtn;

      requestAnimationFrame(()=> {
        inner.style.transition = 'transform 420ms cubic-bezier(.22,.9,.32,1), left .42s, top .42s, width .42s, height .42s';
        inner.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
      });
    }

    function closeZoom(){
      if(!zoomState.open) return;
      overlay.style.display = 'none';
      const outer = zoomState.outer;
      const inner = outer ? outer.querySelector('.zoom-inner') : null;
      if(zoomState.origEl && inner){
        const rect = zoomState.origEl.getBoundingClientRect();
        inner.style.transition = 'transform 320ms ease-in, left .32s, top .32s, width .32s, height .32s';
        inner.style.left = rect.left + 'px';
        inner.style.top = rect.top + 'px';
        inner.style.width = rect.width + 'px';
        inner.style.height = rect.height + 'px';
        inner.style.transform = 'translate(0,0) scale(1)';
        setTimeout(()=> {
          if(zoomState.outer && zoomState.outer.parentNode) zoomState.outer.parentNode.removeChild(zoomState.outer);
          if(zoomState.closeBtn && zoomState.closeBtn.parentNode) zoomState.closeBtn.parentNode.removeChild(zoomState.closeBtn);
          // restore page scroll
          document.body.classList.remove('modal-open');
          document.body.style.top = '';
          window.scrollTo(0, zoomState.scrollY || 0);
          zoomState = { open:false, origEl:null, scrollY:0, outer:null, closeBtn:null };
        }, 360);
      } else {
        if(zoomState.outer && zoomState.outer.parentNode) zoomState.outer.parentNode.removeChild(zoomState.outer);
        if(zoomState.closeBtn && zoomState.closeBtn.parentNode) zoomState.closeBtn.parentNode.removeChild(zoomState.closeBtn);
        document.body.classList.remove('modal-open');
        document.body.style.top = '';
        window.scrollTo(0, zoomState.scrollY || 0);
        zoomState = { open:false, origEl:null, scrollY:0, outer:null, closeBtn:null };
      }
    }

    // overlay click closes zoom
    document.getElementById('overlay').addEventListener('click', ()=>{ if(zoomState.open) closeZoom(); });

    // defensive
    document.documentElement.style.overflowX = 'hidden';
    document.body.style.overflowX = 'hidden';

    /* ---------- SEARCH / SUGGESTIONS LOGIC (across months, form submit handles mobile keyboard) ---------- */

    // stopwords/déterminants to ignore in the search
    const STOPWORDS = new Set([
      'le','la','les','un','une','des','du','de',"d","l","au","aux","à","a","en",
      'ce','cette','ces','mon','ton','son','notre','votre','leur',
      'et','ou','qui','que','quoi','dans','sur','par','pour','avec','sans','sous','entre','chez','vers',
      'du','de','des'
    ]);

    function normalizeText(s){
      if(!s) return '';
      return s.toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
        .replace(/[^a-z0-9\'\s]+/g,' ') // keep apostrophes for next step
        .trim()
        .replace(/\s+/g,' ');
    }

    function stripSsSuffixes(s){
      return s.replace(/\'?ss\b/g, '').replace(/\bss\b/g,'').replace(/\s+/g,' ').trim();
    }

    function tokensFromString(s){
      const norm = normalizeText(s);
      if(!norm) return [];
      const stripped = stripSsSuffixes(norm);
      const tokens = stripped.split(/\s+/).filter(Boolean);
      return tokens.filter(t => !STOPWORDS.has(t));
    }

    function formatSuggestionLabelFromDate(dateKey, ev){
      const dt = buildDateFromEventInParis(dateKey, ev.time);
      if(dt) return `${formatDateFriendlyParis(dt)} • ${ev.title}`;
      return `${ev.title}`;
    }

    const suggestionsEl = document.getElementById('suggestions');
    const searchInputEl = document.getElementById('search-input');
    const searchBtn = document.getElementById('search-btn');
    const searchForm = document.getElementById('search-form');
    let animateTimeout = null;

    function clearSuggestions(){
      suggestionsEl.innerHTML = '';
      suggestionsEl.classList.remove('visible');
      suggestionsEl.setAttribute('aria-hidden','true');
    }

    function clearPreviousAnimation(){
      const prev = document.querySelector('.day.search-animate');
      if(prev) prev.classList.remove('search-animate');
      if(animateTimeout){ clearTimeout(animateTimeout); animateTimeout = null; }
    }

    function animateDayBoxForEventNode(evEl){
      if(!evEl) return;
      const dayEl = evEl.closest('.day');
      if(!dayEl) return;
      const weekRow = dayEl.closest('.week');
      if(weekRow){
        weekRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
      } else {
        dayEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
      clearPreviousAnimation();
      void dayEl.offsetWidth; // reflow to reset animation
      dayEl.classList.add('search-animate');
      animateTimeout = setTimeout(()=> {
        dayEl.classList.remove('search-animate');
        animateTimeout = null;
      }, 1850);
    }

    /**
     * onSearchTriggered(showAlertIfNone)
     * - searches across all months in eventsData
     * - if no match -> alert "Cette manip n'existe pas" (only when showAlertIfNone === true)
     * - if single match -> automatically switch to that month and animate (no dropdown)
     * - if multiple -> show suggestions dropdown (across months). Clicking an item switches month and animates.
     *
     * New behavior: if the user's full normalized query exactly matches an event's normalized full title
     * (after removing 'ss and normalizing), we treat those matches as the exact set and *don't* return generic
     * matches that only match on a token (so "Nuit" won't flood the dropdown when an exact title exists).
     */
    function onSearchTriggered(showAlertIfNone = true){
      const raw = searchInputEl.value || '';
      const q = raw.trim();
      if(q.length === 0){
        clearSuggestions();
        clearPreviousAnimation();
        return;
      }

      const normQueryFull = stripSsSuffixes(normalizeText(q)); // full normalized query string
      const queryTokens = tokensFromString(q);

      // if only stopwords -> no results
      if(queryTokens.length === 0){
        clearSuggestions();
        clearPreviousAnimation();
        if(showAlertIfNone) alert("Cette manip n'existe pas");
        return;
      }

      // find matches among eventsData (across months)
      const matches = []; // {dateKey, ev}
      const exactMatches = []; // matches where full normalized title equals full normalized query OR tokens equal

      for(const dateKey in eventsData){
        const evs = eventsData[dateKey] || [];
        for(const ev of evs){
          if(!ev || !ev.title) continue;
          const titleFullNorm = stripSsSuffixes(normalizeText(ev.title)); // normalized full title
          const titleTokens = tokensFromString(ev.title);

          // exact full-string equality OR exact token-sequence equality -> exact match
          const tokensEqual = titleTokens.join(' ') === queryTokens.join(' ');
          if(titleFullNorm === normQueryFull || tokensEqual){
            exactMatches.push({ dateKey, ev });
            continue; // don't add to general matches to avoid duplicates
          }

          // otherwise token overlap (partial) -> general match
          const matched = queryTokens.some(st => titleTokens.some(tt => tt === st));
          if(matched){
            matches.push({ dateKey, ev });
          }
        }
      }

      // If we have any exact matches, prefer them exclusively (so "Nuit" won't surface unrelateds if exact found)
      let effectiveMatches = matches;
      if(exactMatches.length > 0){
        effectiveMatches = exactMatches;
      }

      if(effectiveMatches.length === 0){
        clearSuggestions();
        clearPreviousAnimation();
        if(showAlertIfNone) alert("Cette manip n'existe pas");
        return;
      }

      if(effectiveMatches.length === 1){
        clearSuggestions();
        const m = effectiveMatches[0];
        showEventAcrossMonths(m.dateKey, m.ev.title);
        return;
      }

      // multiple -> build suggestions dropdown (for all months) — using effectiveMatches (exact-set if present)
      suggestionsEl.innerHTML = '';
      effectiveMatches.forEach((m, idx) => {
        const item = document.createElement('div');
        item.className = 'item';
        item.setAttribute('role','option');
        item.setAttribute('data-match-index', idx);
        item.innerText = formatSuggestionLabelFromDate(m.dateKey, m.ev);
        item.addEventListener('click', (e) => {
          // fill input with chosen title, switch and animate
          searchInputEl.value = m.ev.title;
          clearSuggestions();
          showEventAcrossMonths(m.dateKey, m.ev.title);
        });
        suggestionsEl.appendChild(item);
      });
      suggestionsEl.classList.add('visible');
      suggestionsEl.setAttribute('aria-hidden','false');
    }

    // Make the form submission handle search — this ensures mobile keyboard "search" / Enter triggers the same action.
    searchForm.addEventListener('submit', (e) => {
      e.preventDefault();
      onSearchTriggered(true);
    });

    // Also keep explicit click handler for the visible button (redundant but safe)
    searchBtn.addEventListener('click', (e) => {
      e.preventDefault();
      onSearchTriggered(true);
    });

    // --- LIVE suggestions: update on every input (no alert during typing)
    searchInputEl.addEventListener('input', (e) => {
      onSearchTriggered(false);
    });

    // Only keep Escape handling on the input (avoid double-calling on Enter because submit handles it)
    searchInputEl.addEventListener('keydown', (e) => {
      if(e.key === 'Escape'){
        searchInputEl.value = '';
        clearSuggestions();
        clearPreviousAnimation();
      }
    });

    // clicking outside suggestions hides them
    document.addEventListener('click', (e) => {
      const withinSearch = e.composedPath().some(el => el === suggestionsEl || el === searchInputEl || el === searchBtn || (el && el.classList && el.classList.contains && el.classList.contains('search-row')));
      if(!withinSearch){
        clearSuggestions();
      }
    });

    // when month changes, keep search input and re-run search silently
    monthSelect.addEventListener('change', () => {
      generateCalendar(parseInt(monthSelect.value,10), daysPerRow);
      clearPreviousAnimation();
      onSearchTriggered(false);
      updateNextEventDisplay();
      updatePagerLabels();
    });

    // when cols (layout) change, regenerate and re-run search so suggestions stay relevant
    colsSelect.addEventListener('change', ()=> {
      const v = parseInt(colsSelect.value,10);
      if(!isNaN(v) && v>=3 && v<=7){
        daysPerRow = v;
        generateCalendar(parseInt(monthSelect.value,10), daysPerRow);
        clearPreviousAnimation();
        onSearchTriggered(false);
        updateNextEventDisplay();
      }
    });

    // defensive hide on resize
    window.addEventListener('resize', () => {
      clearSuggestions();
      updatePagerVisibility(); // recompute pager visibility too
    });

    /* ---------- NEXT EVENT (Prochaine manip) with Europe/Paris timezone & countdown ---------- */

    const nextTitleEl = document.getElementById('next-title');
    const nextWhenEl = document.getElementById('next-when');
    const nextCta = document.getElementById('next-cta');
    const nextCountdownEl = document.getElementById('next-countdown');

    // Interpret common human times used in dataset
    function interpretTimeStringAsHM(timeStr){
      if(!timeStr || timeStr.trim().length === 0) return null;
      const s = timeStr.toLowerCase().trim();
      // exact hh:mm or hhhmm
      const m = s.match(/(\d{1,2})\s*[:h]\s*(\d{2})/);
      if(m){
        let h = parseInt(m[1],10);
        let min = parseInt(m[2],10);
        if(h >= 0 && h < 24 && min >=0 && min < 60) return {h, min};
      }
      if(s.includes('aprem') || s.includes('après') || s.includes('apres')) return {h:15, min:0};
      if(s.includes('soir')) return {h:20, min:0};
      if(s.includes('jusqu')) return {h:18, min:0};
      if(s.includes('matin')) return {h:9, min:0};
      // some entries like "06:00" handled above; fallback numeric hour
      const mm = s.match(/^\d{1,2}$/);
      if(mm){
        let h = parseInt(mm[0],10);
        if(h >= 0 && h < 24) return {h, min:0};
      }
      return null;
    }

    // Get GMT offset minutes for Europe/Paris on a particular date (approx by checking noon that day)
    function parisOffsetMinutesForDate(year, monthIndex, day){
      const test = new Date(Date.UTC(year, monthIndex, day, 12, 0, 0));
      const dtf = new Intl.DateTimeFormat('en-US', { timeZone: 'Europe/Paris', timeZoneName: 'short' });
      const parts = dtf.formatToParts(test);
      const tz = parts.find(p => p.type === 'timeZoneName')?.value || '';
      let signMatch = tz.match(/GMT([+-]\d{1,2})(?::?(\d{2}))?/);
      if(signMatch){
        const hh = parseInt(signMatch[1],10);
        const mm = signMatch[2] ? parseInt(signMatch[2],10) : 0;
        return hh * 60 + (hh >= 0 ? mm : -mm);
      }
      let other = tz.match(/([+-]\d{1,2})/);
      if(other){
        return parseInt(other[1],10) * 60;
      }
      return 60; // default CET
    }

    // Build UTC timestamp for a local Paris date/time (year, monthIndex, day, h, min)
    function utcMsFromParisLocal(year, monthIndex, day, hour, minute){
      const naiveUtcMs = Date.UTC(year, monthIndex, day, hour, minute, 0, 0);
      const offsetMin = parisOffsetMinutesForDate(year, monthIndex, day);
      return naiveUtcMs - offsetMin * 60 * 1000;
    }

    // create Date from dateKey (YYYY-MM-DD) and evTime (string). If evTime cannot be interpreted, use fallback (12:00)
    function buildDateFromEventInParis(dateKey, evTime){
      const parts = (dateKey || '').split('-');
      if(parts.length !== 3) return null;
      const y = parseInt(parts[0],10);
      const m = parseInt(parts[1],10) - 1;
      const d = parseInt(parts[2],10);
      const hm = interpretTimeStringAsHM(evTime);
      const h = hm ? hm.h : 12;
      const min = hm ? hm.min : 0;
      const utcMs = utcMsFromParisLocal(y, m, d, h, min);
      return new Date(utcMs);
    }

    // format datetime friendly in Europe/Paris: "10 sept. 2025 • 20:00"
    function formatDateFriendlyParis(dt){
      if(!dt) return '—';
      const datePart = new Intl.DateTimeFormat('fr-FR', { timeZone: 'Europe/Paris', day: '2-digit', month:'short', year:'numeric' }).format(dt);
      const timePart = new Intl.DateTimeFormat('fr-FR', { timeZone: 'Europe/Paris', hour:'2-digit', minute:'2-digit', hour12:false }).format(dt);
      return `${datePart} • ${timePart}`;
    }

    // find the DOM .event node corresponding to the event object (to "Voir" it)
    function findDomEventNode(dateKey, evTitle){
      const nodes = Array.from(document.querySelectorAll('.event'));
      for(const n of nodes){
        const nk = n.getAttribute('data-event-date') || '';
        const nt = n.getAttribute('data-event-title') || (n.querySelector('.title') ? n.querySelector('.title').innerText : '');
        if(nk === dateKey && nt === evTitle) return n;
      }
      return null;
    }

    // Scroll / animate to event; if month not displayed, switch month (works across months)
    function showEventAcrossMonths(dateKey, evTitle){
      const parts = dateKey.split('-');
      if(parts.length !== 3) return;
      const targetMonth = parseInt(parts[1], 10); // 1-based
      const currentShownMonth = parseInt(monthSelect.value,10);
      if(currentShownMonth !== targetMonth){
        monthSelect.value = String(targetMonth);
        generateCalendar(targetMonth, daysPerRow);
        onSearchTriggered(false);
        setTimeout(()=> {
          const node = findDomEventNode(dateKey, evTitle);
          if(node) animateDayBoxForEventNode(node);
        }, 80);
      } else {
        const node = findDomEventNode(dateKey, evTitle);
        if(node) animateDayBoxForEventNode(node);
      }
    }

    // countdown formatting (toujours avec secondes)
    function fmtCountdown(ms){
      if(ms <= 0) return 'à l’instant';
      const totalSec = Math.floor(ms / 1000);
      const days = Math.floor(totalSec / 86400);
      const hours = Math.floor((totalSec % 86400) / 3600);
      const mins = Math.floor((totalSec % 3600) / 60);
      const secs = totalSec % 60;
      if(days > 0) return `dans ${days}j ${hours}h ${mins}m ${secs}s`;
      if(hours > 0) return `dans ${hours}h ${mins}m ${secs}s`;
      if(mins > 0) return `dans ${mins}m ${secs}s`;
      return `dans ${secs}s`;
    }

    let cachedNext = null; // cached next event data to avoid recalculation each second
    function getNextEvent(){
      const nowUtcMs = Date.now();
      const candidates = [];
      for(const dateKey in eventsData){
        const evs = eventsData[dateKey] || [];
        evs.forEach(ev => {
          if(!ev || !ev.title) return;
          const dt = buildDateFromEventInParis(dateKey, ev.time);
          if(!dt) return;
          if(dt.getTime() >= nowUtcMs){
            candidates.push({ dateKey, ev, dt });
          }
        });
      }
      if(candidates.length === 0) return null;
      candidates.sort((a,b) => a.dt - b.dt);
      return candidates[0];
    }

    function updateNextEventDisplay(){
      const next = getNextEvent();
      cachedNext = next;
      if(!next){
        nextTitleEl.textContent = "Aucune manipulation à venir";
        nextWhenEl.textContent = "";
        nextCountdownEl.textContent = "";
        nextCta.style.display = 'none';
        return;
      }
      nextTitleEl.textContent = next.ev.title;
      nextWhenEl.textContent = formatDateFriendlyParis(next.dt);
      nextCta.style.display = 'inline-flex';

      // wire CTA to show across months
      nextCta.onclick = () => {
        showEventAcrossMonths(next.dateKey, next.ev.title);
      };
      // immediate countdown update
      const now = Date.now();
      nextCountdownEl.textContent = fmtCountdown(next.dt.getTime() - now);
    }

    // update countdown every 1s, and full next event every 60s (or on changes)
    updateNextEventDisplay();
    setInterval(()=> {
      if(cachedNext && cachedNext.dt){
        const now = Date.now();
        const remaining = cachedNext.dt.getTime() - now;
        if(remaining <= 0){
          updateNextEventDisplay();
        } else {
          nextCountdownEl.textContent = fmtCountdown(remaining);
        }
      } else {
        updateNextEventDisplay();
      }
    }, 1000);

    // Ensure when page loads on small screens the layout is correct
    window.addEventListener('load', ()=> {
      onSearchTriggered(false);
      updatePagerLabels();
      updatePagerVisibility();
    });

    // small debug helpers
    window.__dev = {
      buildDateFromEventInParis,
      getNextEvent,
      showEventAcrossMonths
    };

    /* ---------- PAGINATION (apparaît à 2/3 du scroll, centré, label mois au centre) ---------- */
    const pager = document.getElementById('month-pager');
    const pagerPrev = document.getElementById('pager-prev');
    const pagerNext = document.getElementById('pager-next');
    const pagerLabel = document.getElementById('pager-label');

    function updatePagerLabels(){
      const opts = Array.from(monthSelect.options);
      const curIndex = opts.findIndex(o => o.value === monthSelect.value);
      const prevIndex = Math.max(0, curIndex - 1);
      const nextIndex = Math.min(opts.length - 1, curIndex + 1);
      const prevText = opts[prevIndex] ? opts[prevIndex].text : '';
      const nextText = opts[nextIndex] ? opts[nextIndex].text : '';
      // show readable label: prev & next with arrows, center shows active month + year
      pagerPrev.innerText = `◀ ${prevText}`;
      pagerNext.innerText = `${nextText} ▶`;
      pagerLabel.innerText = `${opts[curIndex] ? opts[curIndex].text : ''} ${currentYear}`;
    }

    function setMonthByIndex(index){
      const opts = Array.from(monthSelect.options);
      if(!opts[index]) return;
      monthSelect.value = opts[index].value;
      generateCalendar(parseInt(monthSelect.value,10), daysPerRow);
      clearPreviousAnimation();
      onSearchTriggered(false);
      updateNextEventDisplay();
      updatePagerLabels();
    }

    pagerPrev.addEventListener('click', () => {
      const opts = Array.from(monthSelect.options);
      const curIndex = opts.findIndex(o => o.value === monthSelect.value);
      const prevIndex = Math.max(0, curIndex - 1);
      setMonthByIndex(prevIndex);
      // ensure pager stays visible after click
      updatePagerVisibility();
    });

    pagerNext.addEventListener('click', () => {
      const opts = Array.from(monthSelect.options);
      const curIndex = opts.findIndex(o => o.value === monthSelect.value);
      const nextIndex = Math.min(opts.length - 1, curIndex + 1);
      setMonthByIndex(nextIndex);
      updatePagerVisibility();
    });

    function scrollProgressFraction(){
      const doc = document.documentElement;
      const scrollable = (doc.scrollHeight - window.innerHeight);
      if(scrollable <= 0) return 1;
      return window.scrollY / scrollable;
    }

    function updatePagerVisibility(){
      // appear when scrolled at least 2/3 of the page
      const progress = scrollProgressFraction();
      if(progress >= (2/3)){
        pager.classList.remove('hidden');
        pager.classList.add('visible');
        pager.setAttribute('aria-hidden','false');
      } else {
        pager.classList.remove('visible');
        pager.classList.add('hidden');
        pager.setAttribute('aria-hidden','true');
      }
      updatePagerLabels();
    }

    window.addEventListener('scroll', () => {
      updatePagerVisibility();
    });

    // initial call
    updatePagerLabels();
    updatePagerVisibility();
  </script>
<!-- ================= SERVICE WORKER REGISTRATION & HANDLERS ================= -->
<script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').then(reg => {
        console.log('ServiceWorker registered:', reg);

        // detect updatefound on the registration (new SW installing)
        reg.addEventListener('updatefound', () => {
          const newSW = reg.installing;
          console.log('SW updatefound', newSW);
          if (newSW) {
            newSW.addEventListener('statechange', () => {
              console.log('newSW state:', newSW.state);
            });
          }
        });
      }).catch(err => {
        console.warn('SW registration failed:', err);
      });

      // listen to messages from SW
      navigator.serviceWorker.addEventListener('message', (ev) => {
        if (!ev || !ev.data) return;
        const d = ev.data;
        if (d.type === 'SW_UPDATED') {
          // Only trigger reload if this page was controlled previously (avoid reload on first install)
          if (navigator.serviceWorker.controller) {
            console.log('SW_UPDATED received, reloading via reloadSafe()');
            if (window.reloadSafe) window.reloadSafe();
            else window.location.reload();
          } else {
            console.log('SW_UPDATED received but no controller — ignoring (first install).');
          }
        }
      });

      // also listen for controllerchange as a fallback (will fire when new SW takes control)
      let refreshing = false;
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (refreshing) return;
        refreshing = true;
        console.log('controllerchange detected — reloading');
        setTimeout(() => {
          if (window.reloadSafe) window.reloadSafe();
          else window.location.reload();
        }, 80);
      });
    }
  </script>
</body>
</html>




