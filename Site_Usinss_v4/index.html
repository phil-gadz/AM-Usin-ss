<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>AM Usin'ss</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#121212">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="icon" href="/icon-192.jpg" sizes="192x192" type="image/jpeg">
  <link rel="icon" href="/icon-512.jpg" sizes="512x512" type="image/jpeg">
  <link rel="apple-touch-icon" href="/apple-touch-icon-180.jpg">

  <style>
    /* ================= BASE ================= */
    * { box-sizing: border-box; --day-padding: 6px; }
    html { box-sizing: border-box; }
    body{
      margin:0;
      padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0;
      font-family:'Poppins',sans-serif;
      background:#121212;
      color:#eee;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-x:hidden;
      overflow-y:auto;
      -webkit-overflow-scrolling:touch;
    }

    canvas#particles{ position:fixed; inset:0; width:100%; height:100%; pointer-events:none; z-index:0; display:block; }

    .logo-container{ display:flex; justify-content:center; align-items:center; padding:28px 12px 20px; z-index:1; }
    .logo{ width:200px; max-width:70vw; height:auto; filter:brightness(0) invert(1); display:block; }

    @keyframes glitch-crt {
      0%{transform:translate(0,0)}25%{transform:translate(-2px,2px) skew(.5deg)}50%{transform:translate(2px,-2px) skew(-.5deg)}75%{transform:translate(-1px,-1px)}100%{transform:translate(0,0)}
    }
    .logo.glitch{ filter:brightness(0) invert(1) drop-shadow(-3px 0 magenta) drop-shadow(3px 0 cyan) contrast(2.2); animation:glitch-crt .15s steps(1) infinite; }

    /* ================= KRA CARD ================= */
    .kra-outer{ --outer-radius:12px; width:min(92%,900px); max-width:900px; margin:0 auto; position:relative; z-index:2; }
    .kra-container{
      --bg:#1b1b1f;
      border-radius:12px;
      padding:12px 16px;
      background-image:
        linear-gradient(var(--bg),var(--bg)),
        linear-gradient(90deg,var(--bg) 0%,var(--bg) 42%,#ff4aad 48%,#c86bff 50%,#8e2be2 52%,var(--bg) 58%,var(--bg) 100%);
      background-origin:padding-box,border-box;
      background-clip:padding-box,border-box;
      background-size:100% 100%,300% 100%;
      animation:kra-border-slide 6.8s linear infinite;
      border:2px solid transparent;
      display:flex;
      flex-direction:column;
      align-items:stretch;
      gap:8px;
      color:#eee;
      position:relative;
      overflow:visible;
      isolation:isolate;
    }
    .kra-container::before{
      content:"";
      position:absolute;
      inset:-22px;
      border-radius:calc(12px + 22px);
      background:radial-gradient(50% 60% at 50% 45%, rgba(200,90,240,0.46) 0%, rgba(200,90,240,0.30) 18%, rgba(200,90,240,0.14) 36%, rgba(140,60,220,0.06) 56%, transparent 78%);
      filter:blur(20px);
      z-index:0;
      pointer-events:none;
      transform-origin:center center;
      animation:kra-glow-breathe 3s cubic-bezier(.4,0,.2,1) infinite alternate;
      opacity:0.92;
      backface-visibility:hidden;
    }

    @keyframes kra-border-slide{ 0%{background-position:0% 50%,0% 50%}50%{background-position:0% 50%,100% 50%}100%{background-position:0% 50%,0% 50%} }
    @keyframes kra-glow-breathe{ from{transform:scale(1);filter:blur(16px);opacity:.75}60%{transform:scale(1.045);filter:blur(28px);opacity:.93}to{transform:scale(1.09);filter:blur(40px);opacity:1} }

    .kra-container > * { position:relative; z-index:3; }

    /* header: ligne avec titre centré et bouton éditer aligné à droite sur la même hauteur */
    .kra-header{ display:flex; align-items:center; justify-content:center; width:100%; position:relative; }
    .kra-title{ font-weight:900; font-size:1.25rem; color:#fff; text-transform:uppercase; letter-spacing:.8px; text-shadow:0 2px 6px rgba(255,255,255,.96), 0 0 18px rgba(255,255,255,.86); margin:0; padding:8px 40px; text-align:center; }
    .kra-actions{ position:absolute; right:12px; top:50%; transform:translateY(-50%); display:flex; gap:8px; }

    .kra-btn{ background:#00c3ff; color:#051015; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:700; }
    .kra-btn.secondary{ background:#1f1f1f; color:#fff; border:1px solid rgba(255,255,255,0.06); }

    #kra-msg{ min-height:56px; padding:12px; border-radius:10px; background:rgba(0,0,0,0.28); color:#fff; font-size:1rem; line-height:1.35; text-align:center; }
    #kra-meta{ font-size:.82rem; color:#aaa; display:flex; justify-content:space-between; gap:10px; align-items:center; padding:0 6px; flex-wrap:wrap; }

    /* ================= CONTROLS + CALENDAR ================= */
    /* reduced top spacing so mobile doesn't show big empty area */
    .controls{ width:100%; max-width:1400px; margin:12px auto 0; padding: 6px 12px 8px; box-sizing:border-box; display:flex; flex-direction:column; align-items:center; gap:12px; }

    .title-row h2{ margin:0; font-size:2rem; color:#fff; text-shadow:1px 1px 10px rgba(0,0,0,.7); text-align:center; }

    /* NEW: compact responsive controls row to avoid large gaps on mobile */
    .calendar-controls{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap; /* wraps on small screens */
      width:100%;
      max-width:720px;
      margin-top:6px;
    }

    .calendar-controls .month-selector,
    .calendar-controls .days-selector{
      display:flex;
      align-items:center;
      gap:8px;
      background:transparent;
    }

    .select-wrap{ min-width:140px; }
    select, #month-select, #cols-select{ font-size:1em; padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.06); background-color:#000; color:#fff; -webkit-appearance:none; -moz-appearance:none; appearance:none; text-align:center; min-width:120px; }

    .calendar-wrap{ width:100%; max-width:1400px; padding:18px 12px 40px; box-sizing:border-box; margin:0 auto; }
    .calendar-container{ width:100%; display:block; }

    .week{ display:grid; --cols:3; grid-template-columns: repeat(var(--cols), minmax(0,1fr)); grid-template-rows:auto auto; gap:8px; margin-bottom:22px; align-items:start; width:100%; }
    .header{ background-color: rgba(31,31,31,0.30); color:#fff; font-weight:900; padding:10px 6px; font-size:1.02em; text-align:center; border-radius:10px; text-transform:uppercase; letter-spacing:.6px; min-height:44px; display:flex; align-items:center; justify-content:center; }
    .day{ background-color: rgba(44,44,44,0.18); min-height:110px; border-radius:15px; display:flex; flex-direction:column; justify-content:flex-start; align-items:flex-start; position:relative; cursor:pointer; padding:var(--day-padding); overflow:hidden; transition: transform .28s, box-shadow .28s; box-sizing:border-box; }
    .day:hover{ transform: translateY(-3px); box-shadow:0 14px 34px rgba(0,0,0,0.65); }

    .event{ position:relative; left:calc(var(--day-padding) * -1); width:calc(100% + (var(--day-padding) * 2)); border-radius:12px; color:#fff; font-weight:700; font-size:.95em; margin-bottom:8px; padding:10px 14px; display:flex; flex-direction:column; box-sizing:border-box; overflow-wrap:break-word; border:1px solid rgba(0,0,0,0.12); }
    .event .time{ font-size:.78em; color: rgba(255,255,255,0.98); margin-bottom:6px; font-weight:800; text-shadow: 0 1px 6px rgba(0,0,0,0.35); }
    .event .title{ font-weight:900; font-size:1.02em; }
    .event .description{ font-weight:400; font-size:.85em; color:#eee; margin-top:6px; }

    .event.blue{ background: linear-gradient(135deg,#00baff 0%,#0066ff 100%); box-shadow:0 8px 28px rgba(0,102,255,0.28); }
    .event.red{ background: linear-gradient(135deg,#ff3a7a 0%,#ff6a2a 100%); box-shadow:0 8px 28px rgba(255,60,120,0.26); }
    .event.pink{ background: linear-gradient(135deg,#ff7bdc 0%,#ff4aa8 100%); box-shadow:0 8px 28px rgba(255,80,160,0.24); }
    .event.yellow{ background: linear-gradient(135deg,#ffd400 0%,#ffb200 100%); color:#111; box-shadow:0 8px 28px rgba(255,180,40,0.20); }
    .event.grey{ background: linear-gradient(135deg,#9fa9b8 0%,#6e7076 100%); color:#111; box-shadow:0 8px 28px rgba(80,90,100,0.14); }
    .event.orange{ background: linear-gradient(135deg,#ff9944 0%,#ff7a00 100%); color:#111; box-shadow:0 8px 28px rgba(255,120,50,0.18); }
    .event.green{ background: linear-gradient(135deg,#2bd07b 0%,#0fa55d 100%); color:#05220e; box-shadow:0 8px 28px rgba(20,160,90,0.18); }
    .event.text-black{ color:#000 !important; }

    /* zoom modal */
    .zoom-outer{ position:fixed; z-index:3000; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:auto; }
    .zoom-inner{ position:absolute; transform-origin:center center; transition: transform 380ms cubic-bezier(.22,.9,.32,1), left .42s, top .42s, width .42s, height .42s; will-change:transform; border-radius:14px; overflow:hidden; background:transparent; box-shadow:0 30px 80px rgba(0,0,0,0.6); }
    .zoom-fixed-close{ position:fixed; top:14px; right:14px; z-index:3201; background:#ff004f; color:#fff; border:none; padding:10px 14px; border-radius:9px; cursor:pointer; font-weight:700; box-shadow:0 6px 22px rgba(0,0,0,.45); }

    .overlay{ position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:2999; display:none; }

    .kra-pass-overlay, .kra-editor-overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:2100; background: rgba(0,0,0,0.6); padding:20px; }
    .kra-pass, .kra-editor{ width:100%; max-width:620px; background:#111; padding:14px; border-radius:12px; box-shadow:0 20px 40px rgba(0,0,0,.8); box-sizing:border-box; }
    .kra-editor{ max-height: calc(100vh - 80px); overflow:auto; }
    .kra-pass input[type="password"], .kra-editor textarea{ width:100%; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:#0f0f0f; color:#fff; box-sizing:border-box; }
    .kra-editor textarea{ min-height:140px; resize:vertical; max-height: calc(100vh - 260px); line-height:1.4; }

    .footer{ margin: 18px 0 40px; color: rgba(255,255,255,0.12); font-size:.85rem; text-align:center; }

    @media (max-width:920px){
      .logo{ width:160px; }
      .title-row h2{ font-size:1.6rem; }
      .controls{ margin:10px auto 0; padding:6px 12px 8px; }
      .calendar-controls{ max-width:640px; gap:10px; }
      .select-wrap{ min-width:120px; }
      .week{ gap:10px; }
      .day{ min-height:120px; }
    }
    @media (max-width:420px){
      .week{ --cols:2; grid-template-columns: repeat(var(--cols), minmax(0,1fr)); }
      .logo{ max-width:60vw; }
      .select-wrap{ min-width:100px; }
    }

    /* freeze page while modal open: handled via JS (we set top and add class) */
    body.modal-open{ position:fixed; left:0; right:0; overflow:hidden; }
  </style>
</head>
<body>
  <canvas id="particles"></canvas>

  <div class="logo-container">
    <img src="data:image/png;base64,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" alt="Logo" class="logo">
  </div>

  <div class="kra-outer">
    <div class="kra-container" id="kra-container">
      <div class="kra-header">
        <div class="kra-title">KRA IMPORT'SS</div>
        <div class="kra-actions">
          <button class="kra-btn" id="kra-edit-btn">Éditer</button>
        </div>
      </div>

      <div id="kra-msg">Aucune info pour l'instant.</div>

      <div id="kra-meta">
        <div id="kra-last">Dernière mise à jour: —</div>
        <div id="kra-author"></div>
      </div>
    </div>
  </div>

  <!-- CONTROLS : title + compact responsive controls (remplacé pour corriger mobile spacing) -->
  <div class="controls" role="region" aria-label="Contrôles calendrier">
    <div class="title-row">
      <h2 id="month-title">Septembre 2025</h2>
    </div>

    <div class="calendar-controls" aria-hidden="false">
      <div class="month-selector">
        <div class="select-wrap" style="margin:0;">
          <select id="month-select" aria-label="Choisir le mois">
            <option value="9" selected>Septembre</option>
            <option value="10">Octobre</option>
            <option value="11">Novembre</option>
          </select>
        </div>
      </div>

      <div class="days-selector" style="align-items:center;">
        <label for="cols-select" style="font-size:0.95rem; color:#ddd; margin-right:6px;">Jours/ligne</label>
        <div class="select-wrap">
          <select id="cols-select" aria-label="Nombre de jours par ligne">
            <option value="3" selected>3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="calendar-wrap">
    <div class="calendar-container" id="calendar"></div>
  </div>

  <!-- PASS overlay -->
  <div class="kra-pass-overlay" id="kra-pass-overlay" aria-hidden="true">
    <div class="kra-pass" role="dialog" aria-modal="true">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <strong style="color:#fff">PASS requis</strong>
        <button onclick="closePass()" style="background:transparent; color:#fff;border:0;font-size:18px;cursor:pointer">✕</button>
      </div>
      <div style="margin-top:8px; color:#ddd; font-size:0.95rem;">Entre le PASS pour éditer.</div>
      <input id="kra-pass-input" type="password" placeholder="PASS" aria-label="Pass pour éditer" />
      <div style="display:flex; gap:8px; margin-top:12px; justify-content:flex-end;">
        <button class="kra-btn" id="kra-pass-ok">OK</button>
        <button class="kra-btn secondary" onclick="closePass()">Annuler</button>
      </div>
    </div>
  </div>

  <!-- EDIT overlay -->
  <div class="kra-editor-overlay" id="kra-editor-overlay" aria-hidden="true">
    <div class="kra-editor" role="dialog" aria-modal="true">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <strong style="color:#fff">Modifier Kra Import'ss</strong>
        <button onclick="closeKraEditor()" style="background:transparent; color:#fff;border:0;font-size:18px;cursor:pointer">✕</button>
      </div>

      <textarea id="kra-input" placeholder="Tape ton message ici — court, clair, efficace..."></textarea>

      <div style="display:flex; gap:8px; margin-top:10px; justify-content:flex-end;">
        <button class="kra-btn" id="kra-save-btn">Publier</button>
        <button class="kra-btn secondary" id="kra-clear-btn">Vider</button>
        <button class="kra-btn secondary" id="kra-cancel-btn">Annuler</button>
      </div>
    </div>
  </div>

  <div class="overlay" id="overlay"></div>

  <div class="footer">224 Corp.</div>

  
<script>
(function(){
  const KRA_ENDPOINT = '/.netlify/functions/kra';
  const SERVER_PASS = '123'; // doit matcher KRA_PASS dans Netlify env
  const LOCAL_KEY = 'kra_current_v1'; // même key que le render existant

  async function fetchKraFromServer(){
    try{
      const r = await fetch(KRA_ENDPOINT);
      if(!r.ok) throw new Error('fetch error ' + r.status);
      const json = await r.json();
      if(json && json.text !== undefined){
        // store with the same key the page already listens to
        localStorage.setItem(LOCAL_KEY, JSON.stringify(json));
        if(typeof renderKra === 'function') {
          try { renderKra(json); } catch(e){ console.warn(e); }
        }
      }
    }catch(e){
      console.warn('fetchKra error', e);
    }
  }

  async function saveKraToServer(text){
    try{
      const r = await fetch(KRA_ENDPOINT, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ text, pass: SERVER_PASS })
      });
      if(!r.ok){
        const err = await r.json().catch(()=>({ error: r.status }));
        alert('Erreur sauvegarde: ' + (err.error || r.status));
        return null;
      }
      const data = await r.json();
      localStorage.setItem(LOCAL_KEY, JSON.stringify(data));
      if(typeof renderKra === 'function') {
        try { renderKra(data); } catch(e){ console.warn(e); }
      }
      return data;
    }catch(e){
      console.error(e);
      alert('Impossible de contacter le serveur.');
      return null;
    }
  }

  function overrideSaveHandler(){
    // try several possible selectors to be robust
    const saveBtn = document.getElementById('kra-save-btn') 
                 || document.querySelector('[data-kra-save]') 
                 || document.querySelector('.kra-save') 
                 || document.querySelector('#kra-save');
    const kraInput = document.getElementById('kra-input') 
                  || document.querySelector('[data-kra-input]') 
                  || document.querySelector('.kra-input') 
                  || document.querySelector('#kra-input');
    if(!saveBtn || !kraInput){
      console.warn('Save button or input not found');
      return;
    }

    // override previous behavior: replace onclick/handlers so we POST to the server
    saveBtn.onclick = async function(evt){
      evt && evt.preventDefault && evt.preventDefault();
      const text = (kraInput.value || '').trim();
      await saveKraToServer(text);
      if(typeof closeKraEditor === 'function'){
        try { closeKraEditor(); } catch(e){ console.warn(e); }
      }
    };
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    overrideSaveHandler();
    fetchKraFromServer();
    setInterval(fetchKraFromServer, 5000);
  });

  // expose for debugging in console
  window._kra_debug = { fetchKraFromServer, saveKraToServer };
})();
</script>


</body>
</html>
